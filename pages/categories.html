<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browse Categories - LibreShelf</title>

    <!-- CSS -->
    <link href="../src/output.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Core Scripts -->
    <script type="module" src="../js/api.js"></script>
    <script src="../js/theme.js"></script>
  </head>
  <body
    class="bg-background dark:bg-slate-900 font-primary text-text-black dark:text-gray-100 antialiased transition-colors duration-300"
  >
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <main
      class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16 min-h-screen"
    >
      <!-- HEADER & SEARCH -->
      <div class="flex flex-col items-center text-center mb-10">
        <div class="relative w-full max-w-2xl group">
          <input
            type="text"
            id="search-input"
            placeholder="Search by title, author..."
            class="w-full pl-12 pr-32 py-4 rounded-full border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-lg focus:outline-none focus:border-accent dark:focus:border-accent shadow-sm transition-colors"
          />
          <i
            class="ph-bold ph-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-2xl text-gray-400 group-focus-within:text-accent transition-colors"
          ></i>
          <button
            id="search-btn"
            class="absolute right-2 top-2 bottom-2 bg-primary hover:bg-secondary text-white px-6 rounded-full font-bold transition-colors"
          >
            Search
          </button>
        </div>
      </div>

      <!-- LAYOUT -->
      <div class="flex flex-col lg:flex-row gap-8 relative">
        <!-- Mobile Filter Toggle -->
        <div
          class="lg:hidden flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 sticky top-24 z-30"
        >
          <span class="font-bold text-primary dark:text-white">Filters</span>
          <button
            id="filter-toggle-btn"
            class="flex items-center gap-2 text-sm font-bold text-accent"
          >
            <i class="ph-bold ph-faders"></i> Show Filters
          </button>
        </div>

        <!-- SIDEBAR: FILTER -->
        <aside
          id="filter-sidebar"
          class="hidden lg:block lg:w-64 flex-shrink-0 lg:sticky lg:top-28 h-fit space-y-6"
        >
          <div
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-gray-100 dark:border-slate-700 shadow-sm"
          >
            <div class="flex items-center justify-between mb-4">
              <h3
                class="font-bold text-primary dark:text-white flex items-center gap-2"
              >
                <i class="ph-fill ph-books text-accent"></i> Categories
              </h3>
              <button
                id="clear-filters"
                class="text-xs text-red-500 hover:underline hidden"
              >
                Clear
              </button>
            </div>
            <!-- Categories injected here by JS -->
            <div
              id="category-list"
              class="space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar pr-2"
            >
              <div class="animate-pulse space-y-2">
                <div
                  class="h-4 bg-gray-200 dark:bg-slate-700 rounded w-3/4"
                ></div>
                <div
                  class="h-4 bg-gray-200 dark:bg-slate-700 rounded w-1/2"
                ></div>
              </div>
            </div>
          </div>
        </aside>

        <!-- BOOK GRID -->
        <div class="flex-1">
          <!-- Count -->
          <div class="mb-4 flex justify-between items-center">
            <p class="text-sm text-gray-500 dark:text-gray-400">
              Showing
              <span
                id="book-count"
                class="font-bold text-primary dark:text-white"
                >0</span
              >
              results
            </p>
          </div>

          <!-- Grid Container -->
          <div
            id="books-grid"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6"
          >
            <!-- Cards injected here -->
          </div>

          <!-- Loading Spinner -->
          <div id="loading-indicator" class="hidden py-12 text-center w-full">
            <i class="ph-bold ph-spinner animate-spin text-4xl text-accent"></i>
            <p class="mt-2 text-gray-500">Loading...</p>
          </div>

          <!-- Infinite Scroll Trigger -->
          <div id="scroll-sentinel" class="h-4 w-full"></div>

          <!-- Empty State -->
          <div
            id="empty-state"
            class="hidden flex-col items-center justify-center py-20 text-center"
          >
            <i
              class="ph-duotone ph-magnifying-glass text-4xl text-gray-400 mb-2"
            ></i>
            <h3 class="text-lg font-bold text-primary dark:text-white">
              No books found
            </h3>
          </div>
        </div>
      </div>
    </main>

    <!-- Scroll Top -->
    <button
      id="scroll-top-btn"
      onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
      class="fixed bottom-8 right-8 bg-primary hover:bg-secondary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center translate-y-20 opacity-0 transition-all duration-300 z-40 pointer-events-none"
    >
      <i class="ph-bold ph-arrow-up text-xl"></i>
    </button>

    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="../js/navbar.js"></script>
    <!-- MAIN LOGIC SCRIPT -->
    <script type="module" src="../js/categories.js"></script>

    <script>
      renderNavbar("navbar-container", "categories");

      // Simple UI Toggles
      const filterBtn = document.getElementById("filter-toggle-btn");
      const sidebar = document.getElementById("filter-sidebar");
      if (filterBtn) {
        filterBtn.addEventListener("click", () => {
          sidebar.classList.toggle("hidden");
          if (!sidebar.classList.contains("hidden")) {
            sidebar.className =
              "fixed inset-0 z-50 bg-white dark:bg-slate-900 p-6 overflow-y-auto lg:hidden";
            // Add close button if missing
            if (!document.getElementById("close-mobile-filter")) {
              const close = document.createElement("button");
              close.id = "close-mobile-filter";
              close.innerHTML = '<i class="ph-bold ph-x text-2xl"></i>';
              close.className =
                "absolute top-4 right-4 text-primary dark:text-white";
              close.onclick = () => filterBtn.click();
              sidebar.prepend(close);
            }
          } else {
            sidebar.className =
              "hidden lg:block lg:w-64 flex-shrink-0 lg:sticky lg:top-28 h-fit space-y-6";
          }
        });
      }

      const scrollTopBtn = document.getElementById("scroll-top-btn");
      window.addEventListener("scroll", () => {
        scrollTopBtn.classList.toggle("translate-y-20", window.scrollY < 500);
        scrollTopBtn.classList.toggle("opacity-0", window.scrollY < 500);
        scrollTopBtn.classList.toggle(
          "pointer-events-none",
          window.scrollY < 500
        );
      });
    </script>
  </body>
</html>
